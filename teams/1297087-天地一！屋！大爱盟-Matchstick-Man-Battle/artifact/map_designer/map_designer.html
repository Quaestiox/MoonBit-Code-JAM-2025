<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2D Box2D 地图设计器</title>

    <script type="module" crossorigin src="./assets/main-DFp6CaF7.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/main-CGMmujfv.css">
    <link rel="stylesheet" href="../styles/buttons.css">
  </head>
  <body>
    <div id="app">
      <!-- 顶部工具栏 -->
      <div id="toolbar" class="toolbar">
        <div class="toolbar-group">
          <h1 class="app-title">Box2D 地图设计器</h1>
        </div>

        <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
            <a href="../index.html"><button type="button" id="btn-back-home" class="nav-btn">返回主页面</button></a>
            <a href="../map_loader/map_loader.html"><button type="button" id="btn-open-designer" class="nav-btn secondary">打开地图加载器</button></a>
        </div>
        
        <div class="toolbar-group">
          <button id="tool-select" class="tool-btn active" data-tool="select" title="选择工具 (V)">
            <svg width="20" height="20" viewBox="0 0 20 20">
              <path d="M2 2 L2 18 L8 12 L11 18 L13 17 L10 11 L18 11 Z" fill="currentColor"/>
            </svg>
            <span>选择</span>
          </button>
          
          <button id="tool-rect" class="tool-btn" data-tool="rect" title="矩形 (R)">
            <svg width="20" height="20" viewBox="0 0 20 20">
              <rect x="3" y="3" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span>矩形</span>
          </button>
          
          <button id="tool-circle" class="tool-btn" data-tool="circle" title="圆形 (C)">
            <svg width="20" height="20" viewBox="0 0 20 20">
              <circle cx="10" cy="10" r="7" fill="none" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span>圆形</span>
          </button>
          
          <button id="tool-polygon" class="tool-btn" data-tool="polygon" title="多边形 (P)">
            <svg width="20" height="20" viewBox="0 0 20 20">
              <polygon points="10,2 18,14 2,14" fill="none" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span>多边形</span>
          </button>
        </div>
        
        <div class="toolbar-group">
          <!-- 距离关节已屏蔽
          <button id="tool-distance-joint" class="tool-btn" data-tool="distanceJoint" title="距离关节 (D)">
            <svg width="20" height="20" viewBox="0 0 20 20">
              <line x1="4" y1="10" x2="16" y2="10" stroke="currentColor" stroke-width="2"/>
              <circle cx="4" cy="10" r="2" fill="currentColor"/>
              <circle cx="16" cy="10" r="2" fill="currentColor"/>
            </svg>
            <span>距离关节</span>
          </button>
          -->
          
          <button id="tool-revolute-joint" class="tool-btn" data-tool="revoluteJoint" title="旋转关节 (J)">
            <svg width="20" height="20" viewBox="0 0 20 20">
              <circle cx="10" cy="10" r="4" fill="none" stroke="currentColor" stroke-width="2"/>
              <circle cx="10" cy="10" r="2" fill="currentColor"/>
            </svg>
            <span>旋转关节</span>
          </button>
        </div>
        
        <div class="toolbar-group">
          <button id="tool-delete" class="tool-btn" data-tool="delete" title="删除 (Delete)">
            <svg width="20" height="20" viewBox="0 0 20 20">
              <path d="M6 2 L14 2 M4 5 L16 5 M5 5 L5 18 L15 18 L15 5" fill="none" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span>删除</span>
          </button>
        </div>
        
        <div class="toolbar-group ml-auto">
          <button id="btn-undo" class="btn" title="撤销 (Ctrl+Z)" disabled>
            <svg width="16" height="16" viewBox="0 0 16 16" style="vertical-align: middle; margin-right: 4px;">
              <path d="M8 3 L3 8 L8 13" fill="none" stroke="currentColor" stroke-width="2"/>
              <path d="M3 8 H13" stroke="currentColor" stroke-width="2"/>
            </svg>
            撤销
          </button>
          <button id="btn-redo" class="btn" title="重做 (Ctrl+Y)" disabled>
            <svg width="16" height="16" viewBox="0 0 16 16" style="vertical-align: middle; margin-right: 4px;">
              <path d="M8 3 L13 8 L8 13" fill="none" stroke="currentColor" stroke-width="2"/>
              <path d="M13 8 H3" stroke="currentColor" stroke-width="2"/>
            </svg>
            重做
          </button>
          <button id="btn-new" class="btn" title="新建">新建</button>
          <button id="btn-save" class="btn" title="保存">保存</button>
          <button id="btn-load" class="btn" title="加载">加载</button>
          <input type="file" id="file-input" accept=".json" style="display: none;" />
          <button id="btn-export" class="btn btn-primary" title="导出Box2D JSON">导出</button>
          <button id="btn-preview" class="btn btn-success" title="物理预览 (Space)">▶ 预览</button>
        </div>
      </div>

      <!-- 主内容区 -->
      <div class="main-content">
        <!-- 左侧画布区 -->
        <div class="canvas-container">
          <canvas id="design-canvas" width="1000" height="700"></canvas>
          
          <!-- 物理预览控制栏 -->
          <div id="preview-controls" class="preview-controls" style="display: none;">
            <button id="btn-preview-play" class="btn btn-small">▶ 播放</button>
            <button id="btn-preview-pause" class="btn btn-small" style="display: none;">⏸ 暂停</button>
            <button id="btn-preview-reset" class="btn btn-small">🔄 重置</button>
            <button id="btn-preview-exit" class="btn btn-small btn-danger">✕ 退出预览</button>
            <span class="preview-info">物理引擎运行中...</span>
          </div>
          
          <!-- 状态栏 -->
          <div id="status-bar" class="status-bar">
            <span id="status-tool">工具: 选择</span>
            <span id="status-objects">对象: 0</span>
            <span id="status-coords">坐标: (0, 0)</span>
            <span id="status-message"></span>
          </div>
        </div>

        <!-- 右侧属性面板 -->
        <div id="property-panel" class="property-panel">
          <div class="panel-header">
            <h3 class="panel-title">属性面板</h3>
            <button id="btn-toggle-panel" class="btn-toggle-panel" title="收起/展开面板">
              <svg width="16" height="16" viewBox="0 0 16 16" class="toggle-icon">
                <path d="M6 4 L10 8 L6 12" fill="none" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
          </div>
          
          <div class="panel-content-wrapper">
          <!-- 视图设置 -->
          <div class="view-settings">
            <div class="view-settings-title">🔧 视图设置</div>
            
            <div class="property-field">
              <label>画布宽度 (px): <span id="canvas-width-value">1000</span></label>
              <input type="range" id="canvas-width-slider" min="600" max="2000" value="1000" step="50">
              <div class="hint">600-2000 像素</div>
            </div>
            
            <div class="property-field">
              <label>画布高度 (px): <span id="canvas-height-value">700</span></label>
              <input type="range" id="canvas-height-slider" min="400" max="1500" value="700" step="50">
              <div class="hint">400-1500 像素</div>
            </div>
            
            <div class="property-field">
              <label>缩放 (PPM): <span id="ppm-value">20</span></label>
              <input type="range" id="ppm-slider" min="5" max="50" value="20" step="1">
              <div class="hint">像素/米 (5=缩小, 50=放大)</div>
            </div>
            
            <div class="property-field">
              <label>原点 X (m): <span id="origin-x-value">0.00</span></label>
              <input type="range" id="origin-x-slider" min="-20" max="20" value="0" step="0.5">
            </div>
            
            <div class="property-field">
              <label>原点 Y (m): <span id="origin-y-value">0.00</span></label>
              <input type="range" id="origin-y-slider" min="-20" max="20" value="0" step="0.5">
            </div>
            
            <button id="btn-reset-view" class="btn btn-small">重置视图</button>
          </div>
          
          <div id="property-content" class="property-content">
            <p class="placeholder">请选择一个对象以编辑其属性</p>
          </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Box2D 物理引擎 -->
    <script type="text/javascript" src="./box2d-js/lib/jquery-1.4.2.min.js" ></script>
    <script type="text/javascript">
      jQuery.noConflict();
      Object.extend = jQuery.extend;
    </script>
    <script src="./box2d-js/lib/jquery.svg.min.js"></script>
    <script src="./box2d-js/lib/box2d.js"></script>
    

  </body>
</html>
